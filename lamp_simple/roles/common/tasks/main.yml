---
- debug: msg="The operating system is {{ ansible_distribution }}"

- name: print variables
  debug:
    msg: "Username: {{ username }}, Home dir: {{ home }}"

- name: Create variable from  /etc/hosts
  command: cat /etc/hosts
  register: hosts_content
- debug: msg="{{hosts_content.stdout}}"

- name: output of var replace
  debug:
    msg: "{{ replace }}"

- name: var replace
  debug:
    msg: "{{ replace | replace('-', '!!!!') }}"


- name: Check if hosts file contains the word "localhost"
  debug:
    msg: "/etc/hosts file contains the word localhost"
  when: hosts_content.stdout.find("localhost") != -1

- name: hosts replace
  debug:
    msg: "{{ hosts_content.stdout | replace('localhost', 'jorge') }}"

- debug:
    msg:
     - "The value of port is {{ port_no }}"
     - "The value of pkg is {{ pkg_name }}"
     - "The value of hostname is {{ inventory_hostname }}"
     - "The value of node name is {{ ansible_hostname }}"
     - "Ansible version is {{ ansible_version }}"


#works from below
- name: Facts
  setup:
- name: Dump
  delegate_to: localhost
  run_once: true
  copy:
    content: "{{ hostvars[inventory_hostname] | to_nice_json }}"
    dest: /tmp/setup-dump.json

- name: Print all available facts
  ansible.builtin.debug:
    var: ansible_facts

- name: test set fact
  set_fact:
    interfaces_list: "{{ ansible_interfaces | select('match', '^(eth|lo.*|)[0-9]+') | list}}"
 #   interface_list: "{{ ansible_interfaces | select('match','lo.*') | list | first }}"
- debug:
    msg: The interface's list on "{{ ansible_hostname }}" is "{{ interfaces_list }}"

#- debug:
#    msg: The interface's list on "{{ ansible_hostname }}" is "{{ interface_list }}"

- debug: msg="The operating system is {{ ansible_distribution }}" 
 
- name: Execute the command only rhel77 server
  become: yes
  become_user: root 
  shell: "systemctl restart sshd"
  register: mynode
  when: ansible_hostname == 'rhel77'
- debug: var=mynode 


- debug:
    msg: "{{ansible_hostname}}"

# Print the Dictionary
- debug:
    msg: "{{ansible_mounts}}"
    
#- name: mount nfs when "{{ansible_hostname}}"
#  shell: "mount -v -t nfs linuxnfs.file.core.windows.net:/linuxnfs/linuxnfs1 /mount/linuxnfs/linuxnfs1 -o vers=4,minorversion=1,sec=sys"
#  when: ansible_hostname == 'rhel77'
#  register: mymnt
# - debug: var=mymnt 

- name: Mount NFS volumes with noauto according to boot option
  mount:
    src:  linuxnfs.file.core.windows.net:/linuxnfs/linuxnfs1
    path: /mount/linuxnfs/linuxnfs1
    opts: rw,sync,hard
    boot: false
    state: mounted
    fstype: nfs


- debug:
    msg: "Mount Point {{item.mount}} is at {{item.block_used/item.block_total*100}} percent "
  loop: "{{ansible_mounts}}"
  when: item.fstype == 'nfs4'

- name: Add jorgetest group
  group:
    name: jorgetest
    gid: 598240
    state: present

- name: Download and untar perl mod
  unarchive:
    src: https://dlcdn.apache.org/perl/mod_perl-2.0.12.tar.gz
    dest: /home/jorge
    remote_src: yes
    creates: /home/jorge/mod_perl-2.0.12
    validate_certs: no
    owner: jorge
    group: jorge
    
- name: update permissions
  file:
    path: /home/jorge/mod_perl-2.0.12
    recurse: yes
    mode: '0755'
  

- name: Disable auto logout part 1
  replace:
    path: /etc/ssh/sshd_config
    regexp: 'ClientAliveInterval'
    replace: '#ClientAliveInterval'
 
- name: Disable auto logout part 2
  replace:
    path: /etc/ssh/sshd_config
    regexp: 'ClientAliveCountMax'
    replace: '#ClientAliveCountMax'


- name: Add jorgetest group
  command: "getent passwd jorge"
  register: getent
- debug: msg="{{getent.stdout}}"

- name: test to see if selinux is running
  command: getenforce
  register: sestatus
  changed_when: true
- debug: msg="{{sestatus.stdout}}"

- name: Create variable from ehhco
  command: "echo Hello"
  register: command_output
- debug: msg="{{command_output.stdout}}"


- name: Create variable from  /etc/hosts
  command: cat /etc/hosts
  register: command_output1
- debug: msg="{{command_output1.stdout}}"


   
